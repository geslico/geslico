<div class="row"> 
    <h3 class="large-1 columns">Inventario</h3>
</div> 

<div>
  <%= search_form_for @q do |f| %>

    <div class="row">
      <div class="small-12 medium-2 large-2 columns">
        <%= f.label :nCodSede_eq, 'Código Sede' %>
        <%= f.search_field :nCodSede_eq %> 
      </div>    
      <div class="small-12 medium-5 large-5 columns">
        <%= f.label :sede_cNombre_cont, 'Nombre Sede' %>
        <%= f.search_field :sede_cNombre_cont %> 
      </div>
      <div class="small-12 medium-5 large-5 columns">
        <%= f.label :sede_cDireccion_cont, 'Dirección Sede' %>
        <%= f.search_field :sede_cDireccion_cont %> 
      </div>      
    </div>  

    <div class="row">
      <div class="small-12 medium-2 large-2 columns">
        <%= f.label :nCodRack_eq, 'Código Rack'%>
        <%= f.search_field :nCodRack_eq %> 
      </div>                
      <div class="small-12 medium-5 large-5 columns">
        <%= f.label :edrs_cNombre_cont, 'Nombre Electrónica Red'%>
        <%= f.search_field :edrs_cNombre_cont %> 
      </div>                  
      <div class="small-12 medium-5 large-5 columns">
        <%= f.label :edrs_cIPGestion_eq, 'IP Electrónica Red'%>
        <%= f.search_field :edrs_cIPGestion_eq %> 
      </div>      
    </div>        

    <div class="row clearfix" >                 
      <%= submit_tag "Buscar" , class:"button small float-right" %> 
      <%= link_to "Limpiar", request.path, :class => "button small float-right" %>
    </div>
<% end %>   
                  
<div>
    <ul class="accordion margin-bottom test" data-accordion data-multi-expand="true" data-allow-all-closed="true">
    <% @sedes_racks.each do |sede_rack| %>      
        <% if !sede_rack.nCodSede.nil? %>  
            <% if @primeravez != true %>  
                        <!-- fin ul accordeon rack -->        
                        </ul>
                    <!-- fin div accordeon rack -->            
                    </div>
                <!-- fin div accordeon content sede -->            
                </div>
            <!-- fin li accordeon sede -->    
            </li>
            <%else%>    
                <% @primeravez = false %>
            <%end%>    
            <li class="accordion-item" data-accordion-item>          
                <a href="#" class="accordion-title accordionhover"><%= sede_rack.sede.cNombre %></a>
                <div class="accordion-content level1content" data-tab-content >                  
                    <div class="row">
                        <div class="small-4 medium-2 large-2 columns">                    
                            <label for="middle-label"><strong>Código:</strong></label>
                        </div>              
                        <div class="small-4 medium-7 large-7 columns">
                            <td><%= link_to sede_rack.nCodSede, sede_path(sede_rack.nCodSede), {:class=>'link'} %></td>
                        </div> 
                        <div class="small-4 medium-3 large-3 columns">
                           <%= link_to current_url(:format=>:csv, :codSede=>sede_rack.nCodSede), class: "float-right", title: 'Exportar a csv' do %>
                                <i class="fi-page-export-csv large icon"></i><% end %>
                           <% if !sede_rack.sede_edr_map.nil? %>                    
                                <%= link_to sede_rack.sede_edr_map.to_s, class: "float-right", title: 'Mostrar mapa EdR' do %>
                                <i class="fi-foundation large icon"></i><% end %>                         
                           <% end %>                           
                        </div>     
                    </div>           
                    <div class="row">                                                   
                        <div class="small-4 medium-2 large-2 columns">                    
                            <label for="middle-label"><strong>Dirección:</strong></label>
                        </div>              
                        <div class="small-8 medium-10 large-10 columns">
                            <label for="middle-label"><%= sede_rack.sede.cDireccion%>, <%= sede_rack.sede.cCodPostal%></label>
                        </div> 
                    </div>
                    </br> 
                    <% if sede_rack.sedeA.lin_dato.activas.length > 0 || sede_rack.sedeB.lin_dato.activas.length > 0%>
                        <label class="" for="middle-label"><strong>Líneas de datos:</strong></label>
                        <div class="table-scroll">
                            <table>
                                <thead class="color-cabecera">
                                    <tr>
                                        <th>Código</th>
                                        <th>Tipo Datos</th>
                                        <th>Sede Origen</th>
                                        <th>Sede Destino</th>
                                    </tr>
                                </thead>                                
                                <tbody>                
                                    <% (sede_rack.sedeA.lin_dato.activas | sede_rack.sedeA.lin_dato.activas).each do |lin_dato| %>
                                        <tr>        
                                            <td><%= link_to lin_dato.nCodLinDatos, lin_dato_path(lin_dato.nCodLinDatos), {:class=>'link'} %></td>          
                                            <td><%= lin_dato.tipo_lin_dato.cDescTipDatos %></td>           
                                            <td><%= lin_dato.sedeA.cNombre %></td>    
                                            <td>
                                                <% if !lin_dato.sedeB.nil? %> 
                                                    <%= lin_dato.sedeB.cNombre %></td>    
                                                <% end %>                                                    
                                            </td>
                                        </tr>                    
                                    <% end %>                
                                </tbody>
                            </table>
                        </div>
                    <% end %>   
                    <!-- Level 2: rack -->
                    <div class="row">
                        <label class="" for="middle-label"><strong>Racks:</strong></label>
                        <ul class="accordion margin-bottom" data-accordion data-multi-expand="true" data-allow-all-closed="true">                                                   
        <%end%>
                            <%= render 'rack', rack: sede_rack, ip: params[:q]["edrs_cIPGestion_eq"], name: params[:q]["edrs_cNombre_cont"] %>
    <% end %>    
                        <!-- fin ul accordeon rack -->        
                        </ul>
                    <!-- fin div accordeon rack -->            
                    </div>
                <!-- fin div accordeon content sede -->            
                </div>
            <!-- fin li accordeon sede -->    
            </li>    
    <!-- fin ul accordeon sede -->
    </ul>
</div>

